{% extends 'base.html' %}
{% load static %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å | UmbrellaBet{% endblock %}
{% block static %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
{% endblock %}

{% block content %}
<div class="profile-main-card">
    {% if not user.profile.email_confirmed %}
    <div class="profile-alert">
        <span class="profile-alert-emoji">‚ö†Ô∏è</span>
        <div>
            <strong>–í–∞—à email –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω!</strong>
            <p>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ email, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.</p>
            <a href="{% url 'accounts:resend-confirmation' %}" class="profile-btn yellow">
                <i class="fas fa-envelope"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∏—Å—å–º–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ
            </a>
        </div>
    </div>
    {% endif %}

    <div class="profile-header-block">
        <div class="profile-avatar">
            {% if user.profile.avatar %}
                <img src="{{ user.profile.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä {{ user.username }}">
            {% else %}
                <span class="profile-avatar-initial">{{ user.username|slice:":1"|upper }}</span>
            {% endif %}
        </div>
        <div class="profile-user-info">
            <h1>{{ user.username }} <span class="profile-emoji">üéÆ</span></h1>
            <div class="profile-email">{{ user.email }}</div>
            <div class="profile-balance">
                <span>–ë–∞–ª–∞–Ω—Å:</span>
                <span class="profile-balance-value">{{ user.profile.balance }} <img src="{% static 'account/123.png' %}" alt="coin" width="22"></span>
                <button class="profile-btn green">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
            </div>
            <div class="profile-referral">
                <span class="profile-ref-label">–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥:</span>
                <span class="profile-ref-code" id="referralCode">{{ user.profile.referral_code }}</span>
                <button class="profile-btn blue" onclick="copyReferralCode(this)">
                    <i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                </button>
            </div>
            <a href="{% url 'accounts:edit_profile' %}" class="profile-btn purple"><i class="fas fa-user-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        </div>
    </div>

    <div class="profile-stats-cards">
        <div class="profile-stat-card">
            <div class="profile-stat-title">–í—ã–∏–≥—Ä–∞–Ω–æ —Å—Ç–∞–≤–æ–∫</div>
            <div class="profile-stat-value">{{ user.profile.wins }} üèÜ</div>
        </div>
        <div class="profile-stat-card">
            <div class="profile-stat-title">–í—Å–µ–≥–æ —Å—Ç–∞–≤–æ–∫</div>
            <div class="profile-stat-value">{{ user.profile.total_bets }} üé≤</div>
        </div>
        <div class="profile-stat-card">
            <div class="profile-stat-title">–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞</div>
            <div class="profile-stat-value">{{ user.profile.win_rate }}%</div>
        </div>
        <div class="profile-stat-card">
            <div class="profile-stat-title">–°—É–º–º–∞ –≤—ã–∏–≥—Ä—ã—à–µ–π</div>
            <div class="profile-stat-value">{{ user.profile.total_won }} <img src="{% static 'account/123.png' %}" alt="coin" width="18"></div>
        </div>
    </div>

    <div class="profile-section">
        <h2 class="profile-section-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç–∞–≤–∫–∏</h2>
        <div class="table-wrapper">
            <table class="profile-table">
                <thead>
                    <tr>
                        <th>–ú–∞—Ç—á</th>
                        <th>–°—Ç–∞–≤–∫–∞</th>
                        <th>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–í–æ–∑–º–æ–∂–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–î–∞—Ç–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for bet in user.bets.all|slice:":10" %}
                    <tr>
                        <td data-label="–ú–∞—Ç—á">{{ bet.match.team1 }} vs {{ bet.match.team2 }}</td>
                        <td data-label="–°—Ç–∞–≤–∫–∞">{{ bet.get_bet_type_display }}</td>
                        <td data-label="–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç">{{ bet.odds }}</td>
                        <td data-label="–°—É–º–º–∞">{{ bet.amount }} ‚ÇΩ</td>
                        <td data-label="–í–æ–∑–º–æ–∂–Ω—ã–π –≤—ã–∏–≥—Ä—ã—à">{{ bet.possible_win }} ‚ÇΩ</td>
                        <td data-label="–°—Ç–∞—Ç—É—Å" class="bet-status {{ bet.status }}">{{ bet.get_status_display }}</td>
                        <td data-label="–î–∞—Ç–∞">{{ bet.created_at|date:"d.m.Y H:i" }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" style="text-align: center;">–í—ã –µ—â–µ –Ω–µ –¥–µ–ª–∞–ª–∏ —Å—Ç–∞–≤–æ–∫</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="profile-section">
        <h2 class="profile-section-title">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h2>
        <div class="table-wrapper">
            <table class="profile-table">
                <thead>
                    <tr>
                        <th>–¢–∏–ø</th>
                        <th>–°—É–º–º–∞</th>
                        <th>–î–∞—Ç–∞</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</th>
                        <th>ID</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transaction in user.transactions.all|slice:":5" %}
                    <tr>
                        <td data-label="–¢–∏–ø">{{ transaction.get_transaction_type_display }}</td>
                        <td data-label="–°—É–º–º–∞">{{ transaction.amount }} ‚ÇΩ</td>
                        <td data-label="–î–∞—Ç–∞">{{ transaction.created_at|date:"d.m.Y H:i" }}</td>
                        <td data-label="–°—Ç–∞—Ç—É—Å" class="transaction-status {{ transaction.status }}">{{ transaction.get_status_display }}</td>
                        <td data-label="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">{{ transaction.comment|default:"" }}</td>
                        <td data-label="ID">
                            <button class="profile-btn blue" onclick="copyTransactionId(this, '{{ transaction.transaction_id }}')">
                                <i class="fas fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" style="text-align: center;">–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function copyReferralCode(btn) {
    const code = document.getElementById('referralCode').innerText;
    navigator.clipboard.writeText(code).then(() => {
        const original = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i> –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
        btn.classList.add('copied');
        btn.disabled = true;
        setTimeout(() => {
            btn.innerHTML = original;
            btn.classList.remove('copied');
            btn.disabled = false;
        }, 1800);
    });
}
function copyTransactionId(btn, transactionId) {
    navigator.clipboard.writeText(transactionId).then(() => {
        const original = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i> –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!';
        btn.classList.add('copied');
        btn.disabled = true;
        setTimeout(() => {
            btn.innerHTML = original;
            btn.classList.remove('copied');
            btn.disabled = false;
        }, 1800);
    });
}
</script>
{% endblock %}

{% block extra_css %}
<style>
body {
    background: linear-gradient(120deg, #f3f4f6 0%, #e0e7ff 100%);
}
.profile-main-card {
    max-width: 950px;
    width: 100%;
    margin: 2.5rem auto;
    background: #fff;
    border-radius: 22px;
    box-shadow: 0 6px 32px rgba(59,130,246,0.11);
    padding: 2.5rem 2rem 2rem 2rem;
    box-sizing: border-box;
}
.profile-alert {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    background: #fff7e6;
    border: 2px solid #f59e42;
    border-radius: 12px;
    padding: 1rem 1.5rem;
    margin-bottom: 1.5rem;
}
.profile-alert-emoji {
    font-size: 2.5rem;
}
.profile-header-block {
    display: flex;
    gap: 2.5rem;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 2rem;
}
.profile-avatar {
    width: 125px;
    height: 125px;
    border-radius: 50%;
    background: linear-gradient(135deg, #3b82f6 60%, #f59e42 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 12px rgba(59,130,246,0.15);
    border: 5px solid #fff;
    overflow: hidden;
    flex-shrink: 0;
}
.profile-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
}
.profile-avatar-initial {
    color: #fff;
    font-size: 3.5rem;
    font-weight: 700;
    font-family: 'Montserrat', sans-serif;
}
.profile-user-info {
    flex: 1 1 300px;
    min-width: 0;
}
.profile-user-info h1 {
    margin: 0 0 0.5rem 0;
    font-family: 'Montserrat', sans-serif;
    font-size: 2.1rem;
    font-weight: 700;
    color: #3b82f6;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
}
.profile-emoji {
    font-size: 1.7rem;
}
.profile-email {
    color: #64748b;
    margin-bottom: 1rem;
    word-break: break-word;
}
.profile-balance {
    margin: 1rem 0 1.2rem 0;
    font-size: 1.15rem;
    font-weight: 600;
    color: #22223b;
    display: flex;
    align-items: center;
    gap: 0.6rem;
    flex-wrap: wrap;
}
.profile-balance-value {
    color: #f59e42;
    font-weight: 700;
    font-size: 1.2rem;
}
.profile-referral {
    background: #f3e8ff;
    border-radius: 8px;
    padding: 0.5rem 1rem;
    display: flex;
    align-items: center;
    gap: 0.7rem;
    margin-bottom: 1.2rem;
    font-size: 1rem;
    flex-wrap: wrap;
}
.profile-ref-label {
    color: #a21caf;
    font-weight: 600;
}
.profile-ref-code {
    font-family: 'Courier New', monospace;
    color: #3b82f6;
    font-weight: 700;
    word-break: break-all;
}
.profile-btn {
    border: none;
    border-radius: 8px;
    padding: 0.5rem 1.2rem;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    margin: 0.2rem;
    transition: background 0.2s, transform 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    text-decoration: none;
}
.profile-btn.green { background: linear-gradient(90deg, #10b981, #3b82f6); color: #fff; }
.profile-btn.blue { background: linear-gradient(90deg, #3b82f6, #a21caf); color: #fff; }
.profile-btn.purple { background: linear-gradient(90deg, #a21caf, #3b82f6); color: #fff; }
.profile-btn.yellow { background: linear-gradient(90deg, #f59e42, #fbbf24); color: #fff; }
.profile-btn:hover { transform: scale(1.07); filter: brightness(1.1); }
.profile-btn.copied {
    background: linear-gradient(90deg, #10b981, #3b82f6);
    color: #fff;
    filter: brightness(1.15);
}
.profile-stats-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1.3rem;
    margin-bottom: 2rem;
}
.profile-stat-card {
    background: #e0e7ff;
    border-radius: 12px;
    padding: 1.2rem 1rem;
    text-align: center;
    box-shadow: 0 2px 8px rgba(59,130,246,0.08);
}
.profile-stat-title {
    font-size: 1.1rem;
    color: #6366f1;
    font-weight: 600;
    margin-bottom: 0.5rem;
}
.profile-stat-value {
    font-size: 1.4rem;
    font-weight: 700;
    color: #3b82f6;
}
.profile-section {
    margin-bottom: 2.5rem;
}
.profile-section-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: #a21caf;
    margin-bottom: 1rem;
}
.table-wrapper {
    overflow-x: auto;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(59,130,246,0.06);
}
.profile-table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
    min-width: 600px;
}
.profile-table th, .profile-table td {
    padding: 0.7rem 1rem;
    text-align: center;
    border-bottom: 1px solid #f1f5f9;
}
.profile-table th {
    background: #f3f4f6;
    color: #3b82f6;
    font-weight: 700;
    position: sticky;
    top: 0;
}
.profile-table tr:nth-child(even) {
    background: #f9fafb;
}
.bet-status.completed { color: #10b981; font-weight: 700; }
.bet-status.failed, .bet-status.lost { color: #ef4444; font-weight: 700; }
.bet-status.pending { color: #f59e42; font-weight: 700; }
.transaction-status.completed { color: #10b981; font-weight: 700; }
.transaction-status.failed { color: #ef4444; font-weight: 700; }
.transaction-status.pending { color: #f59e42; font-weight: 700; }

/* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 900px) {
    .profile-main-card {
        padding: 1.5rem 1rem;
        margin: 1rem auto;
    }
    .profile-header-block {
        flex-direction: column;
        align-items: center;
        gap: 1.5rem;
        text-align: center;
    }
    .profile-stats-cards {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
    }
}

@media (max-width: 768px) {
    .profile-main-card {
        padding: 1rem 0.5rem;
        border-radius: 16px;
    }
    .profile-avatar {
        width: 100px;
        height: 100px;
    }
    .profile-avatar-initial {
        font-size: 2.8rem;
    }
    .profile-user-info h1 {
        font-size: 1.8rem;
        justify-content: center;
    }
    .profile-balance {
        justify-content: center;
        font-size: 1rem;
    }
    .profile-referral {
        justify-content: center;
        text-align: center;
    }
    .profile-btn {
        padding: 0.4rem 1rem;
        font-size: 0.9rem;
    }
    .profile-stats-cards {
        grid-template-columns: repeat(2, 1fr);
    }
    .profile-stat-card {
        padding: 1rem 0.5rem;
    }
    .profile-stat-title {
        font-size: 1rem;
    }
    .profile-stat-value {
        font-size: 1.2rem;
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
    .profile-table {
        min-width: auto;
    }
    .profile-table thead {
        display: none;
    }
    .profile-table, .profile-table tbody, .profile-table tr, .profile-table td {
        display: block;
    }
    .profile-table tr {
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        margin-bottom: 1rem;
        padding: 1rem;
        background: #fff;
    }
    .profile-table td {
        text-align: left;
        padding: 0.3rem 0;
        border: none;
        position: relative;
        padding-left: 40%;
    }
    .profile-table td:before {
        content: attr(data-label) ": ";
        position: absolute;
        left: 0;
        width: 35%;
        font-weight: 600;
        color: #64748b;
    }
}

@media (max-width: 480px) {
    .profile-main-card {
        margin: 0.5rem auto;
        padding: 0.8rem 0.3rem;
    }
    .profile-alert {
        flex-direction: column;
        text-align: center;
        gap: 1rem;
    }
    .profile-alert-emoji {
        font-size: 2rem;
    }
    .profile-user-info h1 {
        font-size: 1.5rem;
    }
    .profile-stats-cards {
        grid-template-columns: 1fr;
    }
    .profile-referral {
        flex-direction: column;
        gap: 0.5rem;
    }
    .profile-btn {
        width: 100%;
        justify-content: center;
        margin: 0.1rem 0;
    }
}
</style>
{% endblock %}
