{% extends 'base.html' %}

{% block title %}–ú–∞—Ç—á–∏ | UmbrellaBet{% endblock %}

{% block content %}
<div class="matches-container">
    <h1 class="matches-title">–ú–∞—Ç—á–∏ <span class="emoji">üéÆ</span></h1>

    <!-- –§–∏–ª—å—Ç—Ä –ø–æ —Å–ø–æ—Ä—Ç—É -->
    <div class="sport-filter">
        <a href="?sport=all" class="filter-btn {% if current_sport == 'all' %}active{% endif %}">
            –í—Å–µ –≤–∏–¥—ã —Å–ø–æ—Ä—Ç–∞
        </a>
        {% for sport in sports %}
        <a href="?sport={{ sport.key }}" class="filter-btn {% if current_sport == sport.key %}active{% endif %}">
            {{ sport.title }}
        </a>
        {% endfor %}
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-section">
        <div class="stat-card">
            <div class="stat-number">{{ total_matches }}</div>
            <div class="stat-label">–í—Å–µ–≥–æ –º–∞—Ç—á–µ–π</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ live_matches|length }}</div>
            <div class="stat-label">Live –º–∞—Ç—á–µ–π</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ upcoming_count }}</div>
            <div class="stat-label">–ü—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ sports|length }}</div>
            <div class="stat-label">–í–∏–¥–æ–≤ —Å–ø–æ—Ä—Ç–∞</div>
        </div>
    </div>

    <!-- –¢–µ–∫—É—â–∏–µ –º–∞—Ç—á–∏ (Live) - –ù–û–í–´–ô –î–ò–ó–ê–ô–ù -->
    {% if live_matches %}
    <div class="live-section">
        <h2 class="live-title">
            <span class="live-indicator">üî¥</span>
            –ü—Ä—è–º–æ —Å–µ–π—á–∞—Å
        </h2>

        <div class="live-matches-grid">
            {% for match in live_matches %}
            <div class="live-match-card">
                <div class="live-badge">
                    <span class="live-dot"></span>
                    LIVE
                </div>

                <div class="match-header">
                    <div class="match-time">
                        <i class="time-icon">üïê</i>
                        {{ match.commence_time|date:"d.m H:i" }}
                    </div>
                    <div class="tournament-info">{{ match.sport.title }}</div>
                </div>

                <div class="teams-container">
                    <div class="team-block">
                        <div class="team-name">{{ match.home_team }}</div>
                        <div class="team-odds">
                            {% for odds in match.odds.all %}
                                {% if odds.outcome == 'home' %}{{ odds.price }}{% endif %}
                            {% endfor %}
                        </div>
                    </div>

                    <div class="vs-section">
                        <div class="vs-text">VS</div>
                        <div class="live-pulse"></div>
                    </div>

                    <div class="team-block">
                        <div class="team-name">{{ match.away_team }}</div>
                        <div class="team-odds">
                            {% for odds in match.odds.all %}
                                {% if odds.outcome == 'away' %}{{ odds.price }}{% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <a href="{% url 'matches:match_detail' match.id %}" class="live-bet-btn">
                    <span class="btn-icon">‚ö°</span>
                    –°–¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫—É
                </a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –º–∞—Ç—á–∏ -->
    {% if matches_by_sport %}
        <div class="upcoming-section">
            <h2 class="upcoming-title">
                <span class="upcoming-icon">‚è∞</span>
                –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –º–∞—Ç—á–∏
            </h2>

            {% for sport_key, sport_data in matches_by_sport.items %}
            <div class="sport-section">
                <h3 class="sport-title">
                    {% if sport_data.sport.key == 'cs2' %}üî´{% elif sport_data.sport.key == 'dota2' %}‚öîÔ∏è{% else %}üéÆ{% endif %}
                    {{ sport_data.sport.title }}
                    <span class="matches-count">({{ sport_data.matches|length }} –º–∞—Ç—á–µ–π)</span>
                </h3>

                <div class="upcoming-matches-grid">
                    {% for match in sport_data.matches %}
                    <a href="{% url 'matches:match_detail' match.id %}" class="upcoming-match-card">
                        <!-- –ö–æ–º–∞–Ω–¥–∞ 1 -->
                        <div class="team-section">
                            <div class="team-name">{{ match.home_team }}</div>
                            <div class="team-odds">
                                {% for odds in match.odds.all %}
                                    {% if odds.outcome == 'home' %}{{ odds.price }}{% endif %}
                                {% endfor %}
                            </div>
                        </div>

                        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                        <div class="match-info">
                            <div class="match-time">{{ match.commence_time|date:"d.m H:i" }}</div>
                            <div class="tournament-name">{{ match.sport.title }}</div>
                            <div class="match-status-small">{{ match.get_status_display }}</div>
                        </div>

                        <!-- –ö–æ–º–∞–Ω–¥–∞ 2 -->
                        <div class="team-section">
                            <div class="team-name">{{ match.away_team }}</div>
                            <div class="team-odds">
                                {% for odds in match.odds.all %}
                                    {% if odds.outcome == 'away' %}{{ odds.price }}{% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="no-matches">
            <div class="no-matches-icon">üòî</div>
            <h3>–ú–∞—Ç—á–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
            <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–π –≤–∏–¥ —Å–ø–æ—Ä—Ç–∞</p>
            <button class="refresh-btn" onclick="window.location.reload()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
    {% endif %}

    <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="info-section">
        <div class="info-card">
            <h4>üéØ –ö–∞–∫ –¥–µ–ª–∞—Ç—å —Å—Ç–∞–≤–∫–∏?</h4>
            <p>–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç—á, —É–∫–∞–∂–∏—Ç–µ —Å—É–º–º—É —Å—Ç–∞–≤–∫–∏ –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ. –í—Å–µ —Å—Ç–∞–≤–∫–∏ –¥–µ–ª–∞—é—Ç—Å—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –º–æ–Ω–µ—Ç–∞–º–∏!</p>
        </div>
        <div class="info-card">
            <h4>üèÜ –†–µ–π—Ç–∏–Ω–≥ –∏–≥—Ä–æ–∫–æ–≤</h4>
            <p>–°–æ—Ä–µ–≤–Ω—É–π—Ç–µ—Å—å —Å –¥—Ä—É–∑—å—è–º–∏ –∏ –æ–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∞–º–∏. –ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—á–∫–∏ –∑–∞ —É—Å–ø–µ—à–Ω—ã–µ –ø—Ä–æ–≥–Ω–æ–∑—ã!</p>
        </div>
        <div class="info-card">
            <h4>üìö –û–±—É—á–µ–Ω–∏–µ</h4>
            <p>–ò–∑—É—á–∞–π—Ç–µ –∞–Ω–∞–ª–∏—Ç–∏–∫—É, —Å–ª–µ–¥–∏—Ç–µ –∑–∞ –∫–æ–º–∞–Ω–¥–∞–º–∏ –∏ —É–ª—É—á—à–∞–π—Ç–µ —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è!</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.matches-container {
    max-width: 1200px;
    margin: 2rem auto;
    padding: 2rem;
}
.matches-title {
    font-family: 'Montserrat', sans-serif;
    font-size: 2.5rem;
    font-weight: 700;
    color: #3b82f6;
    text-align: center;
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    justify-content: center;
}
.emoji {
    font-size: 2.5rem;
}

/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
.stats-section {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-bottom: 2rem;
}
.stat-card {
    background: linear-gradient(135deg, #e0e7ff 0%, #f0f9ff 100%);
    border-radius: 12px;
    padding: 1rem;
    text-align: center;
    border: 1px solid #dbeafe;
}
.stat-number {
    font-size: 1.8rem;
    font-weight: 700;
    color: #3b82f6;
    margin-bottom: 0.3rem;
}
.stat-label {
    font-size: 0.8rem;
    color: #64748b;
    font-weight: 500;
}

.sport-filter {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    justify-content: center;
    flex-wrap: wrap;
}
.filter-btn {
    background: #e0e7ff;
    color: #3b82f6;
    padding: 0.5rem 1.5rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.2s;
}
.filter-btn.active,
.filter-btn:hover {
    background: #3b82f6;
    color: #fff;
    transform: scale(1.05);
}

/* Live –º–∞—Ç—á–∏ */
.live-section {
    margin-bottom: 3rem;
}

.live-title {
    font-size: 2rem;
    font-weight: 700;
    color: #ef4444;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-align: center;
    justify-content: center;
}

.live-indicator {
    font-size: 1.5rem;
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.live-matches-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
}

/* –ï—Å–ª–∏ live –º–∞—Ç—á —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω, —Ç–æ –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
.live-matches-grid:has(.live-match-card:only-child) {
    grid-template-columns: 1fr;
    max-width: 600px;
    margin: 0 auto;
}

/* –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–æ–≤ –±–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ :has() */
.live-matches-grid.single-match {
    grid-template-columns: 1fr;
    max-width: 600px;
    margin: 0 auto;
}

.live-match-card {
    background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
    border-radius: 20px;
    padding: 1.5rem;
    box-shadow:
        0 10px 25px rgba(0,0,0,0.1),
        0 0 0 1px rgba(239,68,68,0.1);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.live-match-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #ef4444, #f59e42, #ef4444);
    background-size: 200% 100%;
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% { background-position: -200% 0; }
    100% { background-position: 200% 0; }
}

.live-match-card:hover {
    transform: translateY(-5px);
    box-shadow:
        0 20px 40px rgba(0,0,0,0.15),
        0 0 0 1px rgba(239,68,68,0.2);
}

.live-badge {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 0.3rem;
    box-shadow: 0 4px 12px rgba(239,68,68,0.3);
}

.live-dot {
    width: 6px;
    height: 6px;
    background: white;
    border-radius: 50%;
    animation: blink 1s infinite;
}

@keyframes blink {
    0%, 50% { opacity: 1; }
    51%, 100% { opacity: 0.3; }
}

.match-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-top: 0.5rem;
}

.match-time {
    display: flex;
    align-items: center;
    gap: 0.3rem;
    color: #64748b;
    font-weight: 600;
    font-size: 0.9rem;
}

.time-icon {
    font-size: 0.8rem;
}

.tournament-info {
    background: #f1f5f9;
    color: #475569;
    padding: 0.3rem 0.8rem;
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
}

.teams-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
    gap: 1rem;
}

.team-block {
    flex: 1;
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
}

.team-name {
    font-weight: 700;
    font-size: 1.1rem;
    color: #1e293b;
    line-height: 1.2;
}

.team-odds {
    background: linear-gradient(135deg, #3b82f6, #1d4ed8);
    color: white;
    padding: 0.6rem 1rem;
    border-radius: 12px;
    font-weight: 700;
    font-size: 1.2rem;
    box-shadow: 0 4px 12px rgba(59,130,246,0.3);
    transition: all 0.2s ease;
    cursor: pointer;
}

.team-odds:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 16px rgba(59,130,246,0.4);
}

.vs-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    flex: 0 0 auto;
}

.vs-text {
    font-weight: 900;
    font-size: 1rem;
    color: #ef4444;
    background: #fef2f2;
    padding: 0.4rem 0.8rem;
    border-radius: 8px;
    border: 2px solid #fecaca;
}

.live-pulse {
    width: 12px;
    height: 12px;
    background: #ef4444;
    border-radius: 50%;
    animation: pulse-grow 1.5s infinite;
}

@keyframes pulse-grow {
    0% {
        transform: scale(1);
        opacity: 1;
    }
    50% {
        transform: scale(1.5);
        opacity: 0.7;
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

.live-bet-btn {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
    padding: 0.8rem 1.5rem;
    border-radius: 12px;
    text-decoration: none;
    font-weight: 700;
    font-size: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(239,68,68,0.3);
}

.live-bet-btn:hover {
    background: linear-gradient(135deg, #dc2626, #b91c1c);
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(239,68,68,0.4);
    color: white;
    text-decoration: none;
}

.btn-icon {
    font-size: 1.1rem;
}

/* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏... */
.stats-section {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: linear-gradient(135deg, #e0e7ff 0%, #f0f9ff 100%);
    border-radius: 12px;
    padding: 1rem;
    text-align: center;
    border: 1px solid #dbeafe;
}

.stat-number {
    font-size: 1.8rem;
    font-weight: 700;
    color: #3b82f6;
    margin-bottom: 0.3rem;
}

.stat-label {
    font-size: 0.8rem;
    color: #64748b;
    font-weight: 500;
}

/* –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ –º–∞—Ç—á–∏ - –Ω–æ–≤—ã–π –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω */
.upcoming-section {
    margin-bottom: 3rem;
}
.upcoming-title {
    font-size: 1.8rem;
    font-weight: 700;
    color: #64748b;
    margin-bottom: 2rem;
    text-align: center;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    justify-content: center;
}
.upcoming-icon {
    font-size: 1.5rem;
}
.sport-section {
    margin-bottom: 2.5rem;
}
.sport-title {
    font-size: 1.4rem;
    font-weight: 700;
    color: #a21caf;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.matches-count {
    font-size: 0.9rem;
    color: #64748b;
    font-weight: 500;
}
.upcoming-matches-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
}
.upcoming-match-card {
    background: #fff;
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 2px 8px rgba(59,130,246,0.06);
    transition: transform 0.2s, box-shadow 0.2s;
    border: 1px solid #e2e8f0;
    text-decoration: none;
    color: inherit;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
}
.upcoming-match-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(59,130,246,0.12);
    text-decoration: none;
    color: inherit;
}
.team-section {
    flex: 1;
    text-align: center;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}
.team-name {
    font-weight: 600;
    font-size: 0.9rem;
    color: #1e293b;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
.team-odds {
    background: #f8fafc;
    color: #3b82f6;
    font-weight: 700;
    font-size: 1.1rem;
    padding: 0.3rem 0.8rem;
    border-radius: 6px;
    border: 1px solid #e2e8f0;
}
.match-info {
    flex: 0 0 auto;
    text-align: center;
    padding: 0 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.2rem;
}
.match-time {
    color: #64748b;
    font-weight: 600;
    font-size: 0.85rem;
}
.tournament-name {
    color: #a21caf;
    font-weight: 500;
    font-size: 0.75rem;
}
.match-status-small {
    background: #10b981;
    color: #fff;
    padding: 0.1rem 0.4rem;
    border-radius: 4px;
    font-size: 0.6rem;
    font-weight: 600;
}

/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–µ–∫—Ü–∏—è */
.info-section {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    margin-top: 3rem;
}
.info-card {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid #e2e8f0;
}
.info-card h4 {
    margin: 0 0 0.8rem 0;
    color: #1e293b;
    font-size: 1.1rem;
    font-weight: 600;
}
.info-card p {
    margin: 0;
    color: #64748b;
    font-size: 0.9rem;
    line-height: 1.5;
}

.no-matches {
    text-align: center;
    padding: 3rem;
    color: #64748b;
}
.no-matches-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}
.refresh-btn {
    background: linear-gradient(90deg, #3b82f6, #f59e42);
    color: #fff;
    border: none;
    padding: 0.6rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 1rem;
    transition: all 0.2s;
}
.refresh-btn:hover {
    transform: scale(1.05);
}

/* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .matches-container {
        padding: 1rem;
    }
    .matches-title {
        font-size: 2rem;
    }
    .stats-section {
        grid-template-columns: repeat(2, 1fr);
    }
    .live-matches-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    .live-match-card {
        padding: 1.2rem;
    }
    .upcoming-matches-grid {
        grid-template-columns: 1fr;
        gap: 0.8rem;
    }
    .upcoming-match-card {
        padding: 0.8rem;
    }
    .info-section {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    .sport-filter {
        gap: 0.5rem;
    }
    .filter-btn {
        padding: 0.4rem 1rem;
        font-size: 0.9rem;
    }
    .team-name {
        font-size: 0.8rem;
    }
    .team-odds {
        font-size: 1rem;
        padding: 0.2rem 0.6rem;
    }
    .match-info {
        padding: 0 0.5rem;
    }
}
</style>
{% endblock %}
